<template>
    <template if:true={isLoading}>
        <div class="loading-spinner">
            <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
            <p>Loading your orders...</p>
        </div>
    </template>

    <template if:false={isLoading}>
        <div class="orders-container">
            
            <!-- Header Section -->
            <div class="orders-header">
                <div class="header-top">
                    <h1>My Orders</h1>
                    <button class="btn-my-account" onclick={handleOpenAccountModal}>
                        üë§ My Account
                    </button>
                </div>
                <template if:true={accountName}>
                    <p class="account-info">Account: <span>{accountName}</span></p>
                </template>
            </div>

            <!-- Account Modal -->
            <template if:true={showAccountModal}>
                <div class="modal-overlay" onclick={handleCloseAccountModal}>
                    <div class="modal-content" onclick={handleModalContentClick}>
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h2>üë§ My Account</h2>
                            <button class="close-btn" onclick={handleCloseAccountModal}>‚úï</button>
                        </div>

                        <!-- Modal Body -->
                        <div class="modal-body">
                            <!-- Account Information Section -->
                            <div class="account-section">
                                <h3 class="section-title">Account Information</h3>
                                <div class="info-row">
                                    <label class="info-label">Business Name:</label>
                                    <span class="info-value">{accountData.BusinessName}</span>
                                </div>
                                <div class="info-row">
                                    <label class="info-label">Email:</label>
                                    <span class="info-value">{accountData.Email}</span>
                                </div>
                                <div class="info-row">
                                    <label class="info-label">Phone:</label>
                                    <span class="info-value">{accountData.Phone}</span>
                                </div>
                                <div class="info-row">
                                    <label class="info-label">Brand Name:</label>
                                    <span class="info-value">{accountData.BrandName}</span>
                                </div>
                            </div>

                            <!-- Shipping Address Section -->
                            <div class="account-section">
                                <div class="section-header">
                                    <h3 class="section-title">Shipping Address</h3>
                                    <button class="btn-edit" onclick={handleToggleEditMode}>
                                        <template if:true={isEditingAddress}>‚ùå Cancel</template>
                                        <template if:false={isEditingAddress}>‚úèÔ∏è Edit</template>
                                    </button>
                                </div>

                                <template if:false={isEditingAddress}>
                                    <div class="address-display">
                                        <div class="info-row">
                                            <label class="info-label">Street:</label>
                                            <span class="info-value">{accountData.ShippingStreet}</span>
                                        </div>
                                        <div class="info-row">
                                            <label class="info-label">City:</label>
                                            <span class="info-value">{accountData.ShippingCity}</span>
                                        </div>
                                        <div class="info-row">
                                            <label class="info-label">State:</label>
                                            <span class="info-value">{accountData.ShippingState}</span>
                                        </div>
                                        <div class="info-row">
                                            <label class="info-label">Postal Code:</label>
                                            <span class="info-value">{accountData.ShippingPostalCode}</span>
                                        </div>
                                        <div class="info-row">
                                            <label class="info-label">Country:</label>
                                            <span class="info-value">{accountData.ShippingCountry}</span>
                                        </div>
                                    </div>
                                </template>

                                <template if:true={isEditingAddress}>
                                    <div class="address-form">
                                        <div class="form-group">
                                            <label class="form-label">Street</label>
                                            <input 
                                                type="text" 
                                                class="form-input" 
                                                value={accountData.ShippingStreet}
                                                onchange={handleAddressFieldChange}
                                                data-field="ShippingStreet">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">City</label>
                                            <input 
                                                type="text" 
                                                class="form-input" 
                                                value={accountData.ShippingCity}
                                                onchange={handleAddressFieldChange}
                                                data-field="ShippingCity">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">State</label>
                                            <input 
                                                type="text" 
                                                class="form-input" 
                                                value={accountData.ShippingState}
                                                onchange={handleAddressFieldChange}
                                                data-field="ShippingState">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Postal Code</label>
                                            <input 
                                                type="text" 
                                                class="form-input" 
                                                value={accountData.ShippingPostalCode}
                                                onchange={handleAddressFieldChange}
                                                data-field="ShippingPostalCode">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Country</label>
                                            <input 
                                                type="text" 
                                                class="form-input" 
                                                value={accountData.ShippingCountry}
                                                onchange={handleAddressFieldChange}
                                                data-field="ShippingCountry">
                                        </div>
                                        <button class="btn-save-address" onclick={handleSaveAddress}>
                                            üíæ Save Address
                                        </button>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Search Bar -->
            <template if:true={hasPreviousOrders}>
                <div class="search-filter-container">
                    <div class="search-section">
                        <input 
                            type="text" 
                            class="search-input" 
                            placeholder="üîç Search by Order ID or Order Number..." 
                            value={searchTerm}
                            onchange={handleSearchChange}>
                    </div>
                </div>
            </template>

            <!-- Dashboard Section -->
            <template if:true={hasCurrentOrder}>
                <div class="dashboard-section">
                    <!-- Order Summary Cards -->
                    <div class="dashboard-title">
                        <h2>üìä Order Dashboard</h2>
                    </div>

                    <div class="summary-cards-container">
                        <div class="summary-card total-orders">
                            <div class="card-icon">üì¶</div>
                            <div class="card-content">
                                <span class="card-label">Total Orders</span>
                                <span class="card-value">{orderSummary.totalOrders}</span>
                            </div>
                        </div>

                        <div class="summary-card pending-orders">
                            <div class="card-icon">‚è≥</div>
                            <div class="card-content">
                                <span class="card-label">Pending Orders</span>
                                <span class="card-value">{orderSummary.pendingOrders}</span>
                            </div>
                        </div>

                        <div class="summary-card monthly-spent">
                            <div class="card-icon">üí∞</div>
                            <div class="card-content">
                                <span class="card-label">Spent This Month</span>
                                <span class="card-value">{formattedMonthlySpent}</span>
                            </div>
                        </div>

                        <div class="summary-card avg-value">
                            <div class="card-icon">üìà</div>
                            <div class="card-content">
                                <span class="card-label">Avg Order Value</span>
                                <span class="card-value">{formattedAvgOrderValue}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Status Breakdown -->
                    <div class="dashboard-row">
                        <div class="dashboard-column">
                            <h3 class="dashboard-subtitle">Order Status Breakdown</h3>
                            <div class="status-breakdown">
                                <template for:each={statusBreakdownList} for:item="status">
                                    <div key={status.name} class="status-item">
                                        <div class="status-bar">
                                            <div class="status-label">{status.name}</div>
                                            <div class="status-count">{status.count}</div>
                                        </div>
                                        <div class="status-progress">
                                            <div class="progress-fill" style="width: 100%;"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Top Products -->
                        <div class="dashboard-column">
                            <h3 class="dashboard-subtitle">Top Products Ordered</h3>
                            <div class="top-products">
                                <template for:each={topProducts} for:item="product">
                                    <div key={product.productId} class="product-item">
                                        <div class="product-rank">#{product.rank}</div>
                                        <div class="product-info">
                                            <div class="product-name">{product.productName}</div>
                                            <div class="product-stats">{product.totalQuantity} items ‚Ä¢ {product.orderCount} orders</div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Continue Shopping Button -->
                    <div class="continue-shopping-container">
                        <button class="btn-continue-shopping" onclick={handleContinueShopping}>
                            üõçÔ∏è Continue Shopping
                        </button>
                    </div>
                </div>
            </template>

            <!-- Current Order Section -->
            <template if:true={hasCurrentOrder}>
                <div class="current-order-section">
                    <h2 class="section-title">üéâ Your Latest Order</h2>
                    
                    <div class="order-card current-order-card">
                        <div class="order-header-row">
                            <div class="order-number-section">
                                <h3 class="order-number">Order #{currentOrder.OrderNumber}</h3>
                                <p class="order-date">{formattedCurrentCreatedDate}</p>
                            </div>
                            <div class="order-status-section">
                                <span class="status-badge {statusBadgeClass}">
                                    {currentOrder.Status}
                                </span>
                            </div>
                        </div>

                        <div class="order-details-grid">
                            <div class="detail-item">
                                <span class="detail-label">Order Total:</span>
                                <span class="detail-value total-value">{formattedCurrentOrderTotal}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Items:</span>
                                <span class="detail-value">{currentOrder.LineItemCount__c}</span>
                            </div>
                        </div>

                        <div class="order-actions">
                            <button class="btn-primary" onclick={handleViewOrderDetails} data-order-id={currentOrder.Id}>
                                üìã View Order Details
                            </button>
                            <template if:true={shouldShowMakePaymentButton}>
                                <button class="btn-payment" onclick={handleOpenPaymentModal} data-order-id={currentOrder.Id}>
                                    üí≥ Make Payment
                                </button>
                            </template>
                            <button class="btn-secondary" onclick={handleContinueShopping}>
                                üõçÔ∏è Continue Shopping
                            </button>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Order Details Section -->
            <template if:true={showOrderDetails}>
                <div class="order-details-section">
                    <div class="details-header">
                        <h2>Order #{selectedOrderDetails.OrderNumber}</h2>
                        <button class="close-btn" onclick={handleCloseDetails}>‚úï</button>
                    </div>

                    <div class="details-content">
                        <!-- Order Info -->
                        <div class="info-section">
                            <h3>Order Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Order Number:</span>
                                    <span class="info-value">{selectedOrderDetails.OrderNumber}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Status:</span>
                                    <span class="info-value">{selectedOrderDetails.Status}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Created Date:</span>
                                    <span class="info-value">{formattedSelectedCreatedDate}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Account:</span>
                                    <span class="info-value">{selectedOrderDetails.Account.Name}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Order Total:</span>
                                    <span class="info-value total-value">{formattedOrderTotal}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Line Items -->
                        <template if:true={selectedOrderDetails.lineItems.length}>
                            <div class="line-items-section">
                                <h3>Order Items</h3>
                                <div class="line-items-table">
                                    <div class="table-header">
                                        <div class="col-product">Product</div>
                                        <div class="col-code">Code</div>
                                        <div class="col-qty">Quantity</div>
                                        <div class="col-price">Unit Price</div>
                                        <div class="col-total">Total</div>
                                    </div>

                                    <template for:each={formattedLineItems} for:item="item">
                                        <div key={item.Id} class="table-row">
                                            <div class="col-product">{item.Product2.Name}</div>
                                            <div class="col-code">{item.Product2.ProductCode}</div>
                                            <div class="col-qty">{item.Quantity}</div>
                                            <div class="col-price">{item.formattedUnitPrice}</div>
                                            <div class="col-total">{item.formattedTotalPrice}</div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- Payment History Section -->
                        <template if:true={orderPayments.length}>
                            <div class="payment-history-section">
                                <h3>üìú Payment History</h3>
                                <div class="payment-history-table">
                                    <div class="table-header">
                                        <div class="col-date">Payment Date</div>
                                        <div class="col-method">Method</div>
                                        <div class="col-amount">Amount</div>
                                        <div class="col-status">Status</div>
                                    </div>
                                    <template for:each={formattedPaymentHistory} for:item="payment">
                                        <div key={payment.Id} class="table-row">
                                            <div class="col-date">{payment.formattedPaymentDate}</div>
                                            <div class="col-method">{payment.Payment_Mode__c}</div>
                                            <div class="col-amount">{payment.formattedAmount}</div>
                                            <div class="col-status">{payment.Payment_Status__c}</div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- Action Buttons -->
                        <div class="details-actions">
                            <template if:true={shouldShowPaymentButtonInDetails}>
                                <button class="btn-payment" onclick={handleOpenPaymentModal} data-order-id={selectedOrderDetails.Id}>
                                    üí≥ Make Payment
                                </button>
                            </template>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Previous Orders Section -->
            <template if:true={hasPreviousOrders}>
                <div class="previous-orders-section">
                    <h2 class="section-title">üìú Previous Orders</h2>
                    
                    <!-- No Results Message -->
                    <template if:false={filteredOrdersCount}>
                        <div class="no-results">
                            <p>No orders found matching your search or filters.</p>
                        </div>
                    </template>
                    
                    <div class="orders-list">
                        <template for:each={displayedPreviousOrders} for:item="order">
                            <div key={order.Id} class="order-card previous-order-card">
                                <div class="order-card-content">
                                    <div class="order-left-section">
                                        <div class="order-number-badge">#{order.OrderNumber}</div>
                                        <div class="order-meta">
                                            <p class="order-date">üìÖ {order.formattedCreatedDate}</p>
                                            <p class="order-items">üì¶ {order.LineItemCount__c} items</p>
                                        </div>
                                    </div>
                                    <div class="order-middle-divider"></div>
                                    <div class="order-right-section">
                                        <div class="order-total">
                                            <span class="total-label">Total Amount</span>
                                            <span class="total-amount">{order.formattedTotalAmount}</span>
                                        </div>
                                        <span class="status-badge status-{order.Status.toLowerCase()}">{order.Status}</span>
                                    </div>
                                </div>
                                <div class="order-card-actions">
                                    <button class="btn-view-details" onclick={handleViewOrderDetails} data-order-id={order.Id}>
                                        View Details ‚Üí
                                    </button>
                                    <template if:true={order.shouldShowPayment}>
                                        <button class="btn-payment btn-small" onclick={handleOpenPaymentModal} data-order-id={order.Id}>
                                            üí≥ Pay Now
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- View All / Show Less Buttons -->
                    <template if:true={shouldShowViewAllButton}>
                        <div class="view-all-container">
                            <button class="btn-view-all" onclick={handleViewAllOrders}>
                                üìã View All Orders ({formattedPreviousOrders.length} total)
                            </button>
                        </div>
                    </template>

                    <template if:true={shouldShowCollapseButton}>
                        <div class="view-all-container">
                            <button class="btn-collapse" onclick={handleCollapsePreviousOrders}>
                                ‚¨ÜÔ∏è Show Less
                            </button>
                        </div>
                    </template>
                </div>
            </template>

            <!-- No Orders Message -->
            <template if:false={hasCurrentOrder}>
                <div class="no-orders-message">
                    <p>üì≠ No orders found yet.</p>
                    <button class="btn-primary" onclick={handleContinueShopping}>
                        Start Shopping
                    </button>
                </div>
            </template>

            <!-- Payment Modal -->
            <template if:true={showPaymentModal}>
                <div class="payment-modal-overlay" onclick={handleClosePaymentModal}>
                    <div class="payment-modal-content" onclick={handleModalPaymentContentClick}>
                        <!-- Modal Header -->
                        <div class="payment-modal-header">
                            <template if:true={showTransactionHistory}>
                                <button class="back-btn" onclick={handleBackFromHistory}>‚Üê Back</button>
                                <h2>üìú Transaction History</h2>
                            </template>
                            <template if:false={showTransactionHistory}>
                                <h2>üí≥ Make Payment</h2>
                                <button class="history-btn" onclick={handleToggleTransactionHistory}>üìã View History</button>
                            </template>
                            <button class="close-btn" onclick={handleClosePaymentModal}>‚úï</button>
                        </div>

                        <!-- Modal Body -->
                        <div class="payment-modal-body">
                            <!-- Transaction History View -->
                            <template if:true={showTransactionHistory}>
                                <template if:true={orderPayments.length}>
                                    <div class="transaction-history-view">
                                        <div class="history-table">
                                            <div class="table-header">
                                                <div class="col-date">Payment Date</div>
                                                <div class="col-method">Method</div>
                                                <div class="col-amount">Amount</div>
                                                <div class="col-transaction">Reference/ID</div>
                                                <div class="col-status">Status</div>
                                            </div>
                                            <template for:each={formattedPaymentHistory} for:item="payment">
                                                <div key={payment.Id} class="table-row">
                                                    <div class="col-date">{payment.formattedPaymentDate}</div>
                                                    <div class="col-method">{payment.Payment_Mode__c}</div>
                                                    <div class="col-amount">{payment.formattedAmount}</div>
                                                    <div class="col-transaction">
                                                        <template if:true={payment.Transaction_Id__c}>
                                                            {payment.Transaction_Id__c}
                                                        </template>
                                                        <template if:false={payment.Transaction_Id__c}>
                                                            {payment.Cash_Receipt_Number__c}
                                                        </template>
                                                    </div>
                                                    <div class="col-status">{payment.Payment_Status__c}</div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                <template if:false={orderPayments.length}>
                                    <div class="no-transactions">
                                        <p>üì≠ No payment history found for this order.</p>
                                    </div>
                                </template>
                            </template>

                            <!-- Payment Form View -->
                            <template if:false={showTransactionHistory}>
                            <!-- Summary Section -->
                            <div class="payment-summary-section">
                                <h3 class="summary-title">Order Summary</h3>
                                <div class="summary-grid">
                                    <div class="summary-item">
                                        <span class="summary-label">Order Amount</span>
                                        <span class="summary-value">{formattedPaymentOrderTotal}</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label">Amount Paid</span>
                                        <span class="summary-value">{formattedPaymentAmountPaid}</span>
                                    </div>
                                    <div class="summary-item outstanding">
                                        <span class="summary-label">Outstanding Amount</span>
                                        <span class="summary-value">{formattedPaymentOutstandingAmount}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Method Selection -->
                            <div class="payment-methods-section">
                                <h3 class="methods-title">Select Payment Method</h3>
                                <div class="payment-options">
                                    <div 
                                        class="payment-option {selectedPaymentMethod === 'Cash' ? 'selected' : ''}" 
                                        data-method="Cash"
                                        onclick={handlePaymentMethodSelect}>
                                        <div class="option-icon">üíµ</div>
                                        <div class="option-label">Cash</div>
                                    </div>

                                    <div 
                                        class="payment-option {selectedPaymentMethod === 'UPI' ? 'selected' : ''}" 
                                        data-method="UPI"
                                        onclick={handlePaymentMethodSelect}>
                                        <div class="option-icon">üì±</div>
                                        <div class="option-label">UPI</div>
                                    </div>

                                    <div 
                                        class="payment-option {selectedPaymentMethod === 'Card' ? 'selected' : ''}" 
                                        data-method="Card"
                                        onclick={handlePaymentMethodSelect}>
                                        <div class="option-icon">üí≥</div>
                                        <div class="option-label">Card</div>
                                    </div>

                                    <div 
                                        class="payment-option {selectedPaymentMethod === 'Bank Transfer' ? 'selected' : ''}" 
                                        data-method="Bank Transfer"
                                        onclick={handlePaymentMethodSelect}>
                                        <div class="option-icon">üè¶</div>
                                        <div class="option-label">Bank Transfer</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Form: Dynamic Fields Based on Payment Method -->
                            <template if:true={showAmountField}>
                                <div class="payment-form-section">
                                    <h3 class="form-title">Payment Details</h3>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Amount <span class="required">*</span></label>
                                        <input 
                                            type="number" 
                                            class="form-control" 
                                            placeholder="Enter payment amount"
                                            value={paymentFormData.amount}
                                            data-field="amount"
                                            onchange={handlePaymentFormChange}
                                            step="0.01"
                                            min="0">
                                    </div>

                                    <!-- Cash Payment Fields -->
                                    <template if:true={showCashFields}>
                                        <div class="form-group">
                                            <label class="form-label">Cash Received By <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Enter name of person who received cash"
                                                value={paymentFormData.cashReceivedBy}
                                                data-field="cashReceivedBy"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Cash Receipt Number <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Enter receipt number"
                                                value={paymentFormData.cashReceiptNumber}
                                                data-field="cashReceiptNumber"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Notes</label>
                                            <textarea 
                                                class="form-control" 
                                                placeholder="Additional notes (optional)"
                                                data-field="notes"
                                                onchange={handlePaymentFormChange}
                                                rows="3"></textarea>
                                        </div>
                                    </template>

                                    <!-- UPI Payment Fields -->
                                    <template if:true={showUPIFields}>
                                        <div class="form-group">
                                            <label class="form-label">UPI ID <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="e.g., user@bankname"
                                                value={paymentFormData.upiId}
                                                data-field="upiId"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">UPI Name <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Name on UPI account"
                                                value={paymentFormData.upiName}
                                                data-field="upiName"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">UPI App Name</label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="e.g., Google Pay, PhonePe"
                                                value={paymentFormData.upiAppName}
                                                data-field="upiAppName"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">UPI Reference Number</label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="UPI reference number (optional)"
                                                value={paymentFormData.upiReferenceNumber}
                                                data-field="upiReferenceNumber"
                                                onchange={handlePaymentFormChange}>
                                        </div>
                                    </template>

                                    <!-- Card Payment Fields -->
                                    <template if:true={showCardFields}>
                                        <div class="form-group">
                                            <label class="form-label">Card Holder Name <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Name on card"
                                                value={paymentFormData.cardHolderName}
                                                data-field="cardHolderName"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Card Number <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="XXXX XXXX XXXX 1234"
                                                value={paymentFormData.cardNumber}
                                                data-field="cardNumber"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Card Type <span class="required">*</span></label>
                                            <select 
                                                class="form-control"
                                                data-field="cardType"
                                                onchange={handlePaymentFormChange}>
                                                <option value="">-- Select Card Type --</option>
                                                <option value="Debit">Debit Card</option>
                                                <option value="Credit">Credit Card</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Transaction ID <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Enter transaction ID"
                                                value={paymentFormData.transactionId}
                                                data-field="transactionId"
                                                onchange={handlePaymentFormChange}>
                                        </div>
                                    </template>

                                    <!-- Bank Transfer Fields -->
                                    <template if:true={showBankTransferFields}>
                                        <div class="form-group">
                                            <label class="form-label">Bank Name <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Enter bank name"
                                                value={paymentFormData.bankName}
                                                data-field="bankName"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">

                                            <label class="form-label">IFSC Code <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Enter IFSC code"
                                                value={paymentFormData.ifscCode}
                                                data-field="ifscCode"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Transfer Reference Number</label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="e.g., UTR or Reference Number"
                                                value={paymentFormData.transferReferenceNumber}
                                                data-field="transferReferenceNumber"
                                                onchange={handlePaymentFormChange}>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Transaction ID <span class="required">*</span></label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                placeholder="Enter transaction ID"
                                                value={paymentFormData.transactionId}
                                                data-field="transactionId"
                                                onchange={handlePaymentFormChange}>
                                        </div>
                                    </template>
                                </div>
                            </template>

                            <!-- Action Buttons -->
                            <div class="payment-actions">
                                <button class="btn-cancel" onclick={handleClosePaymentModal}>
                                    Cancel
                                </button>
                                <button class="btn-submit-payment" onclick={handlePaymentSubmit}>
                                    ‚úì Confirm Payment
                                </button>
                            </div>
                            </template>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </template>
</template>
